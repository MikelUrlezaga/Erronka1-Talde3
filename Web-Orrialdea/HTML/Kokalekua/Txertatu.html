<!DOCTYPE html>
    <head>
        <meta charset="UTF-8">
        <script src="../../script/aldagaiGlobalak.js" ></script>
        <script src="../../script/menu.js" ></script>
        <link rel="stylesheet" href="../../CSS/styles.css">
        <link rel="icon" href="../../IMG/LOGO.png" type="image/x-icon">
        <title>Kokalekua Txertatu</title>
    </head>
    <body onkeydown="teclado(event)">
        <header >
        <a class="logoHeader" href="../../HTML/Orokorra/Home.html">
                <img class="logo" src="../../IMG/LOGO.png">
            </a>
            <p class="titulo">KOKALEKUA TXERTATU</p>
            <div class="headerdiv">
                <a href="Taula.html">
                    <img class="headerimg" src="../../IMG/arrow.png">
                </a>
                <p>&nbsp;</p>
                <a href="../../HTML/Orokorra/Login.html">
                    <img class="headerimg" src="../../IMG/LogOut.png">
                </a>
            </div>
        </header>
        <div class="reborde">
            <p class="texto1Columna">Ekipamendua:</p>
            <div class="zutabeBat" id="boxKokalekuEkipamendua">
                <select id="selectEki" class="textBox">
                </select>
            </div>
            <p class="texto1Columna">Gela:</p>
            <div class="zutabeBat" id="boxKokalekuGela">
                <select  id="selectGela" class="textBox">
                </select>
            </div>
            <p class="texto1Columna">Hasiera Data: </p>
            <input class="textBox1Columna" type="date" id="hasieraDataTxertatu" name="ErosketaData">
            <p class="texto1Columna">Amaiera Data: </p>
            <input class="textBox1Columna" type="date" id="amaieraDataTxertatu" name="ErosketaData">
            <div class="ck">
                <img src="../../IMG/unnamed.png" alt="check" class="checkicon" onclick="createKokalekua()">
            </div>
        </div>
    </body>
    <div id="menuMugikorra"></div>
</html>
<script>
    function fechaActual() {
        const tiempoTranscurrido = Date.now();
        const hoy = new Date(tiempoTranscurrido);

        const dia = hoy.getDate();
        const mes = hoy.getMonth() + 1; 
        const anio = hoy.getFullYear();

        const fechaFormateada = `${anio}-${mes.toString().padStart(2, '0')}-${dia.toString().padStart(2, '0')}`;

        document.getElementById("hasieraDataTxertatu").value = fechaFormateada;
        document.getElementById("amaieraDataTxertatu").value = fechaFormateada;
    }

    window.addEventListener("load", fechaActual);

    function teclado(event) {
    var codigo = event.which || event.keyCode;
    if (codigo==13) {
        createKokalekua()
    }
}
async function bistaratuFromPHPTxertatu() {
        let options = {method: "GET", mode: 'cors'};
        const da = null;
        fetch(rutaBack + "inbentarioa_json.php", options)
            .then(response => response.json())  // Analiza la respuesta JSON
            .then(data => {
                console.log(data);
                console.log(data.length);
                var opElement = document.createElement("option");
                opElement.value = "Nada";
                opElement.innerText="Aukeratu bat";
                document.getElementById("selectEki").appendChild(opElement);

                for(i=0; i < data.length; i++){
                    var opElement = document.createElement("option");
                    opElement.value = data[i].etiketa;
                    opElement.innerText=data[i].marka+" "+data[i].modelo;
                    document.getElementById("selectEki").appendChild(opElement);
                }
            })
            .catch(error => {
                alert("Errorea." + error);
            });


            fetch(rutaBack + "gelak_json.php", options)
            .then(response => response.json())  // Analiza la respuesta JSON
            .then(data => {
                console.log(data);
                console.log(data.length);
                var opElemento = document.createElement("option");
                opElemento.value = "Nada";
                opElemento.innerText="Aukeratu bat";
                document.getElementById("selectGela").appendChild(opElemento);

                for(i=0; i < data.length; i++){
                    var opElemento = document.createElement("option");
                    opElemento.value = data[i].id;
                    opElemento.innerText=data[i].id+" - "+data[i].izena;
                    document.getElementById("selectGela").appendChild(opElemento);
                }
            })
            .catch(error => {
                alert("Errorea." + error);
            });
    }


    window.addEventListener("load", bistaratuFromPHPTxertatu);
    function createKokalekua() {
        var etiketa = document.getElementById("selectEki").value;
        var idGela = document.getElementById("selectGela").value;
        var hasieraData = document.getElementById("hasieraDataTxertatu").value;
        var amaieraData = document.getElementById("amaieraDataTxertatu").value;
        var clasea = {etiketa, idGela, hasieraData, amaieraData};
        var js = JSON.stringify(clasea);
        console.log(js);
        fetch(rutaBack + 'kokalekuak_json.php', {method: 'POST', body: js})
            .then(function (response) {
                    return response.text();
            })
            .then(data=>{
                console.log(data);
                alert(etiketa+"-ren erreserba txertatuta");
            })
            .catch(error => {
                console.log("Erregistro hau beste taula batean erabiltzen ari da, beraz, ezin da ezabatu" + error);
            });
    }
</script>