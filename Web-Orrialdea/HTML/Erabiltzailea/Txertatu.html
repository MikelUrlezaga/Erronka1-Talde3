<!DOCTYPE html>
    <head>
        <script src="../../script/menu.js" ></script>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../../CSS/styles.css">
        <link rel="icon" href="../../IMG/LOGO.png" type="image/x-icon">
        <title>Erabiltzailea Txertatu</title>
    </head>
    <header>
            <img class="logo" src="../../IMG/LOGO.png">
            <p class="titulo">ERABILTZAILEA TXERTATU</p>
            <div class="headerdiv">
                <a href="TaulaErabiltzailea.html">
                    <img class="headerimg" src="../../IMG/arrow.png">
                </a>
                <p>&nbsp;</p>
                <a href="../../HTML/Orokorra/Login.html">
                    <img class="headerimg" src="../../IMG/LogOut.png">
                </a>
            </div>
    </header>
    <body onkeydown="teclado(event)">
        <div class="reborde">
                <br><br><br><br>
                <div class="dobleColumn">
                    <div>
                        <p class="texto">NAN: </p>
                        <input class="textBox" type="text" id="nanErabiltzaileaTxertatu" name="NAN" >
                    </div>
                    <div>
                        <p class="texto">Izena: </p>
                        <input class="textBox" type="text" id="izenaErabiltzaileaTxertatu" name="Izena">
                    </div>
                    <div>
                        <p class="texto">Abizena: </p>
                        <input class="textBox" type="text" id="abizenaErabiltzaileaTxertatu" name="Abizena">
                    </div>
                    <div>
                        <p class="texto">Erabiltzailea: </p>
                        <input class="textBox" type="text" id="erabiltzaileaErabiltzaileaTxertatu" name="Erabiltzailea">
                    </div>
                    <div>
                        <p class="texto">Pasahitza: </p>
                        <input class="textBox" type="text" id="pasahitzaErabiltzaileaTxertatu" name="Pasahitza" >
                    </div>
                    <div>
                        <p class="texto">Rola: </p>
                        <input class="textBox" type="text" id="rolaErabiltzaileaTxertatu" name="Rola">
                    </div>
                    <div class="ck">
                        <img src="../../IMG/unnamed.png" alt="check" class="checkicon" onclick="createErabiltzailea()">
                    </div>
                </div>
        </div>
    </body>
    <div id="menuMugikorra"></div>
</html>
<script>

    function teclado(event) {
        var codigo = event.which || event.keyCode;
        if (codigo==13) {
            createErabiltzailea()
        }
    }
    
    function validateDNI(dni) {
    var numero, let, letra;
    var expresion_regular_dni = /^[XYZ]?\d{5,8}[A-Z]$/;

    dni = dni.toUpperCase();

    if(expresion_regular_dni.test(dni) === true){
        numero = dni.substr(0,dni.length-1);
        numero = numero.replace('X', 0);
        numero = numero.replace('Y', 1);
        numero = numero.replace('Z', 2);
        let = dni.substr(dni.length-1, 1);
        numero = numero % 23;
        letra = 'TRWAGMYFPDXBNJZSQVHLCKET';
        letra = letra.substring(numero, numero+1);
        if (letra != let) {
            //alert('Dni erroneo, la letra del NIF no se corresponde');
            return false;
        }else{
            //alert('Dni correcto');
            return true;
        }
    }else{
        //alert('Dni erroneo, formato no vÃ¡lido');
        return false;
    }
}

    function createErabiltzailea() {
        var nan = document.getElementById("nanErabiltzaileaTxertatu").value;
        var nancorrecto= validateDNI(nan);
        var izena = document.getElementById("izenaErabiltzaileaTxertatu").value;
        var abizena = document.getElementById("abizenaErabiltzaileaTxertatu").value;
        var erabiltzailea = document.getElementById("erabiltzaileaErabiltzaileaTxertatu").value;
        var pasahitza = document.getElementById("pasahitzaErabiltzaileaTxertatu").value;
        var rola = document.getElementById("rolaErabiltzaileaTxertatu").value;
        var clasea = {nan, izena, abizena, erabiltzailea, pasahitza, rola};
        var js = JSON.stringify(clasea);
        console.log(js);
        if(nancorrecto==true){
            fetch('../../PHP/erabiltzailea_json.php', {method: 'POST', body: js})
            .then(function (response) {
                    return response.text();
                    alert("Se ha insertado")
            })
            .then(data=>{
                console.log(data);
                
            })
        }else{
            alert("El DNI esta mal")
        }
        
            // .catch(error => {
            //     //console.log("Erregistro hau beste taula batean erabiltzen ari da, beraz, ezin da ezabatu" + error);
            // });
}
</script>